<ng-template
  #customHeaderTemplate
  let-days="days"
  let-locale="locale"
  let-dayHeaderClicked="dayHeaderClicked"
  let-eventDropped="eventDropped"
  let-trackByWeekDayHeaderDate="trackByWeekDayHeaderDate"
  let-dragEnter="dragEnter"
>
  <div class="cal-day-headers" role="row">
    <div
      class="cal-header"
      *ngFor="let day of days; trackBy: trackByWeekDayHeaderDate"
      [class.cal-past]="day.isPast"
      [class.cal-today]="day.isToday"
      [class.cal-future]="day.isFuture"
      [class.cal-weekend]="day.isWeekend"
      [ngClass]="day.cssClass"
      (mwlClick)="dayHeaderClicked.emit({ day: day, sourceEvent: $event })"
      mwlDroppable
      dragOverClass="cal-drag-over"
      (drop)="
        eventDropped.emit({
          event: $event.dropData.event,
          newStart: day.date
        })
      "
      (dragEnter)="dragEnter.emit({ date: day.date })"
      tabindex="0"
      role="columnheader"
    >
      <b>{{ day.date | calendarDate : "weekViewColumnHeader" : locale }}</b
      ><br />
      <span>{{
        day.date | calendarDate : "weekViewColumnSubHeader" : locale
      }}</span>
      <div class="w-full flex text-center">
        <span
          [style.width.%]="100 / resources.length"
          *ngFor="let r of resources"
          >{{ r.name }}</span
        >
      </div>
    </div>
  </div>
</ng-template>

<ng-template
  #customHourSegmentTemplate
  let-segment="segment"
  let-locale="locale"
  let-segmentHeight="segmentHeight"
  let-isTimeLabel="isTimeLabel"
  let-daysInWeek="daysInWeek"
>
  <div
    [attr.aria-hidden]="
      {}
        | calendarA11y
          : (daysInWeek === 1 ? 'hideDayHourSegment' : 'hideWeekHourSegment')
    "
    class="cal-hour-segment"
    [style.height.px]="segmentHeight"
    [class.cal-hour-start]="segment.isStart"
    [class.cal-after-hour-start]="!segment.isStart"
    [ngClass]="segment.cssClass"
  >
    <div class="cal-time" *ngIf="isTimeLabel">
      {{
        segment.displayDate
          | calendarDate
            : (daysInWeek === 1 ? "dayViewHour" : "weekViewHour")
            : locale
      }}
    </div>

    <div
      class="w-full flex text-center h-full border-l-2 border-lightgray"
      *ngIf="!isTimeLabel"
    >
      <ng-container *ngFor="let r of resources; let last = last">
        <div
          *ngIf="!last"
          class="border-r border-lightgray h-full"
          [style.width.%]="100 / resources.length"
        ></div>
      </ng-container>
    </div>
  </div>
</ng-template>

<div class="w-full h-full">
  <mwl-calendar-week-view
    [viewDate]="viewDate"
    [events]="eventsInternal"
    [headerTemplate]="customHeaderTemplate"
    [hourSegmentTemplate]="customHourSegmentTemplate"
    [refresh]="refresh"
    [weekStartsOn]="1"
    (eventTimesChanged)="eventTimesChanged($event)"
    (eventClicked)="eventClick($event)"
  >
  </mwl-calendar-week-view>
</div>
